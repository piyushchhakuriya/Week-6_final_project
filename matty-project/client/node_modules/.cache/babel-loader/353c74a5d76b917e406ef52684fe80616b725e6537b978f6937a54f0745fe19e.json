{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nfunction drawPolygon(ctx, x, y, radius, sides, color) {\n  ctx.beginPath();\n  for (let i = 0; i < sides; i++) {\n    const angle = 2 * Math.PI * i / sides - Math.PI / 2;\n    const dx = x + radius * Math.cos(angle);\n    const dy = y + radius * Math.sin(angle);\n    if (i === 0) ctx.moveTo(dx, dy);else ctx.lineTo(dx, dy);\n  }\n  ctx.closePath();\n  ctx.fillStyle = color;\n  ctx.fill();\n}\nconst HANDLE_SIZE = 16;\nlet nextId = 1;\nconst getDefaultSize = (type, text, ctx) => {\n  if (type === \"rectangle\") return {\n    w: 120,\n    h: 80\n  };\n  if (type === \"square\" || type === \"circle\") return {\n    w: 100,\n    h: 100\n  };\n  if (type === \"oval\") return {\n    w: 120,\n    h: 80\n  };\n  if (type === \"image\") return {\n    w: 200,\n    h: 200\n  };\n  if (type === \"text\") {\n    ctx.font = \"24px Arial\";\n    return {\n      w: ctx.measureText(text).width,\n      h: 32,\n      fontSize: 24\n    };\n  }\n  return {\n    w: 120,\n    h: 80\n  };\n};\nconst CanvasEditor = () => {\n  _s();\n  const {\n    id\n  } = useParams();\n  const canvasRef = useRef(null);\n  const fileInputRef = useRef(null);\n\n  // UI state\n  const [loading, setLoading] = useState(false);\n  const [designName, setDesignName] = useState(\"\");\n  const [selectedShape, setSelectedShape] = useState(\"rectangle\");\n  const [shapeColor, setShapeColor] = useState(\"#4f46e5\");\n  const [drawMode, setDrawMode] = useState(false);\n  const [eraserMode, setEraserMode] = useState(false);\n  const [eraserSize, setEraserSize] = useState(20);\n  const [textColor, setTextColor] = useState(\"#111827\");\n  const [pencilColor, setPencilColor] = useState(\"#333\");\n  const [brushSize, setBrushSize] = useState(2);\n  const [dragOffset, setDragOffset] = useState({\n    x: 0,\n    y: 0\n  });\n  const [selectedIdx, setSelectedIdx] = useState(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [resizingHandle, setResizingHandle] = useState(null);\n  const drawingPointsRef = useRef([]);\n  const [history, setHistory] = useState([{\n    elements: [],\n    lines: [],\n    title: \"\"\n  }]);\n  const [historyIndex, setHistoryIndex] = useState(0);\n  const [imageCache, setImageCache] = useState({});\n  const {\n    elements,\n    lines,\n    title\n  } = history[historyIndex];\n\n  // Load by id or start blank\n  useEffect(() => {\n    if (id) {\n      setLoading(true);\n      fetch(`http://localhost:5000/api/designs/${id}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n        }\n      }).then(res => res.json()).then(data => {\n        setHistory([{\n          elements: data.elements || [],\n          lines: data.lines || [],\n          title: data.title || \"\"\n        }]);\n        setHistoryIndex(0);\n        setDesignName(data.title || \"\");\n        setLoading(false);\n      }).catch(() => setLoading(false));\n    } else {\n      setHistory([{\n        elements: [],\n        lines: [],\n        title: \"\"\n      }]);\n      setHistoryIndex(0);\n      setDesignName(\"\");\n    }\n  }, [id]);\n  useEffect(() => {\n    setDesignName(title || \"\");\n  }, [title]);\n  const saveState = (newElements, newLines, newTitle = designName) => {\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push({\n      elements: JSON.parse(JSON.stringify(newElements)),\n      lines: JSON.parse(JSON.stringify(newLines)),\n      title: newTitle\n    });\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n    setDesignName(newTitle);\n  };\n\n  // Undo/Redo logic\n  const handleUndo = () => {\n    if (historyIndex > 0) {\n      setHistoryIndex(historyIndex - 1);\n      setSelectedIdx(null);\n    }\n  };\n  const handleRedo = () => {\n    if (historyIndex < history.length - 1) {\n      setHistoryIndex(historyIndex + 1);\n      setSelectedIdx(null);\n    }\n  };\n\n  // Keyboard delete support\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if ((e.key === \"Delete\" || e.key === \"Backspace\") && selectedIdx !== null) {\n        const newElements = elements.filter((_, idx) => idx !== selectedIdx);\n        saveState(newElements, lines, designName);\n        setSelectedIdx(null);\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [elements, lines, selectedIdx, designName]);\n  useEffect(() => {\n    elements.forEach(el => {\n      if (el.type === \"image\" && el.src && !imageCache[el.id]) {\n        const img = new window.Image();\n        img.src = el.src;\n        img.onload = () => setImageCache(c => ({\n          ...c,\n          [el.id]: img\n        }));\n      }\n    });\n  }, [elements, imageCache]);\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.lineCap = \"round\";\n    ctx.lineWidth = 2;\n    elements.forEach((el, idx) => {\n      ctx.save();\n      const {\n        w,\n        h\n      } = el;\n      const cx = el.x + w / 2;\n      const cy = el.y + h / 2;\n      ctx.translate(cx, cy);\n      const rotationRad = (el.rotation || 0) * Math.PI / 180;\n      ctx.rotate(rotationRad);\n      ctx.translate(-cx, -cy);\n      if (el.type === \"image\") {\n        const img = imageCache[el.id];\n        if (img) {\n          ctx.drawImage(img, el.x, el.y, w, h);\n          if (idx === selectedIdx) {\n            ctx.strokeStyle = \"#f59e42\";\n            ctx.lineWidth = 2;\n            ctx.strokeRect(el.x - 2, el.y - 2, w + 4, h + 4);\n            drawHandles(ctx, el.x, el.y, w, h);\n          }\n        }\n      } else if (el.type === \"text\") {\n        ctx.font = `${el.fontSize || 24}px Arial`;\n        ctx.fillStyle = el.color;\n        ctx.fillText(el.text, el.x, el.y + (el.fontSize || 24));\n        const boxW = el.w;\n        const boxH = el.h || (el.fontSize || 24) + 8;\n        if (idx === selectedIdx) {\n          ctx.strokeStyle = \"#f59e42\";\n          ctx.strokeRect(el.x - 2, el.y - 2, boxW + 4, boxH + 4);\n          drawHandles(ctx, el.x, el.y, boxW, boxH);\n        }\n      } else {\n        ctx.fillStyle = el.color;\n        ctx.strokeStyle = el.color;\n        switch (el.type) {\n          case \"rectangle\":\n          case \"square\":\n            ctx.fillRect(el.x, el.y, w, h);\n            break;\n          case \"circle\":\n            ctx.beginPath();\n            ctx.arc(el.x + w / 2, el.y + h / 2, w / 2, 0, 2 * Math.PI);\n            ctx.fill();\n            break;\n          default:\n            break;\n        }\n        if (idx === selectedIdx) {\n          ctx.strokeStyle = \"#f59e42\";\n          ctx.lineWidth = 2;\n          ctx.strokeRect(el.x - 2, el.y - 2, w + 4, h + 4);\n          drawHandles(ctx, el.x, el.y, w, h);\n        }\n      }\n      ctx.restore();\n    });\n    lines.forEach(line => {\n      ctx.beginPath();\n      ctx.strokeStyle = line.mode === \"eraser\" ? \"rgba(0,0,0,1)\" : line.color || \"#333\";\n      ctx.lineWidth = line.size || 2;\n      ctx.globalCompositeOperation = line.mode === \"eraser\" ? \"destination-out\" : \"source-over\";\n      line.points.forEach(([x, y], i) => {\n        if (i === 0) ctx.moveTo(x, y);else ctx.lineTo(x, y);\n      });\n      ctx.stroke();\n      ctx.globalCompositeOperation = \"source-over\";\n    });\n  }, [elements, lines, imageCache, selectedIdx]);\n  function drawHandles(ctx, x, y, w, h) {\n    const handles = [[x - HANDLE_SIZE / 2, y - HANDLE_SIZE / 2], [x + w - HANDLE_SIZE / 2, y - HANDLE_SIZE / 2], [x - HANDLE_SIZE / 2, y + h - HANDLE_SIZE / 2], [x + w - HANDLE_SIZE / 2, y + h - HANDLE_SIZE / 2]];\n    handles.forEach(([hx, hy]) => {\n      ctx.fillStyle = \"#fff\";\n      ctx.strokeStyle = \"#333\";\n      ctx.lineWidth = 1;\n      ctx.fillRect(hx, hy, HANDLE_SIZE, HANDLE_SIZE);\n      ctx.strokeRect(hx, hy, HANDLE_SIZE, HANDLE_SIZE);\n    });\n  }\n  const getHandleAt = (el, mouseX, mouseY) => {\n    const {\n      w,\n      h\n    } = el;\n    const handles = [[el.x - HANDLE_SIZE / 2, el.y - HANDLE_SIZE / 2], [el.x + w - HANDLE_SIZE / 2, el.y - HANDLE_SIZE / 2], [el.x - HANDLE_SIZE / 2, el.y + h - HANDLE_SIZE / 2], [el.x + w - HANDLE_SIZE / 2, el.y + h - HANDLE_SIZE / 2]];\n    for (let i = 0; i < handles.length; i++) {\n      const [hx, hy] = handles[i];\n      if (mouseX >= hx && mouseX <= hx + HANDLE_SIZE && mouseY >= hy && mouseY <= hy + HANDLE_SIZE) {\n        return i;\n      }\n    }\n    return null;\n  };\n  const handleCanvasMouseDown = e => {\n    const mouseX = e.nativeEvent.offsetX;\n    const mouseY = e.nativeEvent.offsetY;\n    let clicked = false;\n    for (let i = elements.length - 1; i >= 0; i--) {\n      const el = elements[i];\n      const handleIdx = getHandleAt(el, mouseX, mouseY);\n      if (i === selectedIdx && handleIdx !== null) {\n        setResizingHandle(handleIdx);\n        clicked = true;\n        break;\n      }\n      if (mouseX >= el.x && mouseX <= el.x + el.w && mouseY >= el.y && mouseY <= el.y + el.h) {\n        setSelectedIdx(i);\n        setDragOffset({\n          x: mouseX - el.x,\n          y: mouseY - el.y\n        });\n        setIsDragging(true);\n        clicked = true;\n        break;\n      }\n    }\n    if (!clicked) setSelectedIdx(null);\n    if (drawMode || eraserMode) {\n      setIsDrawing(true);\n      drawingPointsRef.current = [[mouseX, mouseY]];\n    }\n  };\n  const handleCanvasMouseMove = e => {\n    const mouseX = e.nativeEvent.offsetX;\n    const mouseY = e.nativeEvent.offsetY;\n    if (resizingHandle !== null && selectedIdx !== null) {\n      const el = elements[selectedIdx];\n      const newEl = {\n        ...el\n      };\n      if (resizingHandle === 0) {\n        newEl.x = mouseX;\n        newEl.y = mouseY;\n        newEl.w = el.w + (el.x - mouseX);\n        newEl.h = el.h + (el.y - mouseY);\n      } else if (resizingHandle === 1) {\n        newEl.y = mouseY;\n        newEl.w = mouseX - el.x;\n        newEl.h = el.h + (el.y - mouseY);\n      } else if (resizingHandle === 2) {\n        newEl.x = mouseX;\n        newEl.w = el.w + (el.x - mouseX);\n        newEl.h = mouseY - el.y;\n      } else if (resizingHandle === 3) {\n        newEl.w = mouseX - el.x;\n        newEl.h = mouseY - el.y;\n      }\n      newEl.w = Math.max(20, newEl.w);\n      newEl.h = Math.max(20, newEl.h);\n      if (el.type === \"text\") newEl.fontSize = Math.max(12, newEl.h - 8);\n      const newElements = elements.map((s, idx) => idx === selectedIdx ? newEl : s);\n      setHistory(h => {\n        const newHistory = h.slice(0, historyIndex + 1);\n        newHistory[historyIndex] = {\n          elements: newElements,\n          lines\n        };\n        return newHistory;\n      });\n      return;\n    }\n    if (isDragging && selectedIdx !== null) {\n      const newElements = elements.map((s, idx) => idx === selectedIdx ? {\n        ...s,\n        x: mouseX - dragOffset.x,\n        y: mouseY - dragOffset.y\n      } : s);\n      setHistory(h => {\n        const newHistory = h.slice(0, historyIndex + 1);\n        newHistory[historyIndex] = {\n          elements: newElements,\n          lines\n        };\n        return newHistory;\n      });\n    }\n    if (isDrawing && (drawMode || eraserMode)) {\n      const canvas = canvasRef.current;\n      const ctx = canvas.getContext(\"2d\");\n      const points = drawingPointsRef.current;\n      points.push([mouseX, mouseY]);\n      ctx.beginPath();\n      ctx.moveTo(points[points.length - 2][0], points[points.length - 2][1]);\n      ctx.lineTo(mouseX, mouseY);\n      ctx.lineWidth = eraserMode ? eraserSize : brushSize;\n      ctx.strokeStyle = eraserMode ? \"rgba(0,0,0,1)\" : pencilColor;\n      ctx.globalCompositeOperation = eraserMode ? \"destination-out\" : \"source-over\";\n      ctx.stroke();\n      ctx.globalCompositeOperation = \"source-over\";\n    }\n  };\n  const handleCanvasMouseUp = () => {\n    if (resizingHandle !== null) {\n      setResizingHandle(null);\n      saveState(elements, lines, designName);\n      return;\n    }\n    if (isDragging && selectedIdx !== null) {\n      saveState(elements, lines, designName);\n      setIsDragging(false);\n    }\n    if (isDrawing) {\n      setIsDrawing(false);\n      saveState(elements, lines, designName);\n    }\n  };\n\n  // ... (rest is as in previous full version, including shape/text/image/button handlers, toolbar, sidebar, and canvas UI)\n\n  // Insert all previous \"handleAddShape\", \"handleAddText\", \"handleUploadImage\", \"handleFileChange\", \"handleDownload\", \"handleSaveToCloud\", \n  // moveElement, clearCanvas, and handleDeleteSelected functions as shown in the detailed version above.\n\n  // ...the return JSX (the full UI including buttons and all handlers wired up) also remains the same as in my previous message.\n\n  // Return the same final UI as described earlier (toolbars, sidebar, canvas, and all handlers as above)\n};\n_s(CanvasEditor, \"VUwzgvC9wEKqEbY3Pj/8+acbnw8=\", false, function () {\n  return [useParams];\n});\n_c = CanvasEditor;\nexport default CanvasEditor;\nvar _c;\n$RefreshReg$(_c, \"CanvasEditor\");","map":{"version":3,"names":["React","useRef","useEffect","useState","useParams","drawPolygon","ctx","x","y","radius","sides","color","beginPath","i","angle","Math","PI","dx","cos","dy","sin","moveTo","lineTo","closePath","fillStyle","fill","HANDLE_SIZE","nextId","getDefaultSize","type","text","w","h","font","measureText","width","fontSize","CanvasEditor","_s","id","canvasRef","fileInputRef","loading","setLoading","designName","setDesignName","selectedShape","setSelectedShape","shapeColor","setShapeColor","drawMode","setDrawMode","eraserMode","setEraserMode","eraserSize","setEraserSize","textColor","setTextColor","pencilColor","setPencilColor","brushSize","setBrushSize","dragOffset","setDragOffset","selectedIdx","setSelectedIdx","isDragging","setIsDragging","isDrawing","setIsDrawing","resizingHandle","setResizingHandle","drawingPointsRef","history","setHistory","elements","lines","title","historyIndex","setHistoryIndex","imageCache","setImageCache","fetch","headers","Authorization","localStorage","getItem","then","res","json","data","catch","saveState","newElements","newLines","newTitle","newHistory","slice","push","JSON","parse","stringify","length","handleUndo","handleRedo","handleKeyDown","e","key","filter","_","idx","window","addEventListener","removeEventListener","forEach","el","src","img","Image","onload","c","canvas","current","getContext","clearRect","height","lineCap","lineWidth","save","cx","cy","translate","rotationRad","rotation","rotate","drawImage","strokeStyle","strokeRect","drawHandles","fillText","boxW","boxH","fillRect","arc","restore","line","mode","size","globalCompositeOperation","points","stroke","handles","hx","hy","getHandleAt","mouseX","mouseY","handleCanvasMouseDown","nativeEvent","offsetX","offsetY","clicked","handleIdx","handleCanvasMouseMove","newEl","max","map","s","handleCanvasMouseUp","_c","$RefreshReg$"],"sources":["C:/Users/Kritika Ekka/Week-6_final_project/matty-project/client/src/components/CanvasEditor.jsx"],"sourcesContent":["import React, { useRef, useEffect, useState } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\n\r\nfunction drawPolygon(ctx, x, y, radius, sides, color) {\r\n  ctx.beginPath();\r\n  for (let i = 0; i < sides; i++) {\r\n    const angle = (2 * Math.PI * i) / sides - Math.PI / 2;\r\n    const dx = x + radius * Math.cos(angle);\r\n    const dy = y + radius * Math.sin(angle);\r\n    if (i === 0) ctx.moveTo(dx, dy);\r\n    else ctx.lineTo(dx, dy);\r\n  }\r\n  ctx.closePath();\r\n  ctx.fillStyle = color;\r\n  ctx.fill();\r\n}\r\n\r\nconst HANDLE_SIZE = 16;\r\nlet nextId = 1;\r\n\r\nconst getDefaultSize = (type, text, ctx) => {\r\n  if (type === \"rectangle\") return { w: 120, h: 80 };\r\n  if (type === \"square\" || type === \"circle\") return { w: 100, h: 100 };\r\n  if (type === \"oval\") return { w: 120, h: 80 };\r\n  if (type === \"image\") return { w: 200, h: 200 };\r\n  if (type === \"text\") {\r\n    ctx.font = \"24px Arial\";\r\n    return { w: ctx.measureText(text).width, h: 32, fontSize: 24 };\r\n  }\r\n  return { w: 120, h: 80 };\r\n};\r\n\r\nconst CanvasEditor = () => {\r\n  const { id } = useParams();\r\n  const canvasRef = useRef(null);\r\n  const fileInputRef = useRef(null);\r\n\r\n  // UI state\r\n  const [loading, setLoading] = useState(false);\r\n  const [designName, setDesignName] = useState(\"\");\r\n  const [selectedShape, setSelectedShape] = useState(\"rectangle\");\r\n  const [shapeColor, setShapeColor] = useState(\"#4f46e5\");\r\n  const [drawMode, setDrawMode] = useState(false);\r\n  const [eraserMode, setEraserMode] = useState(false);\r\n  const [eraserSize, setEraserSize] = useState(20);\r\n  const [textColor, setTextColor] = useState(\"#111827\");\r\n  const [pencilColor, setPencilColor] = useState(\"#333\");\r\n  const [brushSize, setBrushSize] = useState(2);\r\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\r\n  const [selectedIdx, setSelectedIdx] = useState(null);\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [isDrawing, setIsDrawing] = useState(false);\r\n  const [resizingHandle, setResizingHandle] = useState(null);\r\n  const drawingPointsRef = useRef([]);\r\n\r\n  const [history, setHistory] = useState([\r\n    { elements: [], lines: [], title: \"\" }\r\n  ]);\r\n  const [historyIndex, setHistoryIndex] = useState(0);\r\n  const [imageCache, setImageCache] = useState({});\r\n  const { elements, lines, title } = history[historyIndex];\r\n\r\n  // Load by id or start blank\r\n  useEffect(() => {\r\n    if (id) {\r\n      setLoading(true);\r\n      fetch(`http://localhost:5000/api/designs/${id}`, {\r\n        headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` }\r\n      })\r\n        .then(res => res.json())\r\n        .then((data) => {\r\n          setHistory([\r\n            { elements: data.elements || [], lines: data.lines || [], title: data.title || \"\" }\r\n          ]);\r\n          setHistoryIndex(0);\r\n          setDesignName(data.title || \"\");\r\n          setLoading(false);\r\n        })\r\n        .catch(() => setLoading(false));\r\n    } else {\r\n      setHistory([{ elements: [], lines: [], title: \"\" }]);\r\n      setHistoryIndex(0);\r\n      setDesignName(\"\");\r\n    }\r\n  }, [id]);\r\n\r\n  useEffect(() => { setDesignName(title || \"\"); }, [title]);\r\n\r\n  const saveState = (newElements, newLines, newTitle = designName) => {\r\n    const newHistory = history.slice(0, historyIndex + 1);\r\n    newHistory.push({\r\n      elements: JSON.parse(JSON.stringify(newElements)),\r\n      lines: JSON.parse(JSON.stringify(newLines)),\r\n      title: newTitle,\r\n    });\r\n    setHistory(newHistory);\r\n    setHistoryIndex(newHistory.length - 1);\r\n    setDesignName(newTitle);\r\n  };\r\n\r\n  // Undo/Redo logic\r\n  const handleUndo = () => {\r\n    if (historyIndex > 0) {\r\n      setHistoryIndex(historyIndex - 1);\r\n      setSelectedIdx(null);\r\n    }\r\n  };\r\n  const handleRedo = () => {\r\n    if (historyIndex < history.length - 1) {\r\n      setHistoryIndex(historyIndex + 1);\r\n      setSelectedIdx(null);\r\n    }\r\n  };\r\n\r\n  // Keyboard delete support\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      if ((e.key === \"Delete\" || e.key === \"Backspace\") && selectedIdx !== null) {\r\n        const newElements = elements.filter((_, idx) => idx !== selectedIdx);\r\n        saveState(newElements, lines, designName);\r\n        setSelectedIdx(null);\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n  }, [elements, lines, selectedIdx, designName]);\r\n\r\n  useEffect(() => {\r\n    elements.forEach((el) => {\r\n      if (el.type === \"image\" && el.src && !imageCache[el.id]) {\r\n        const img = new window.Image();\r\n        img.src = el.src;\r\n        img.onload = () => setImageCache((c) => ({ ...c, [el.id]: img }));\r\n      }\r\n    });\r\n  }, [elements, imageCache]);\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.lineCap = \"round\";\r\n    ctx.lineWidth = 2;\r\n    elements.forEach((el, idx) => {\r\n      ctx.save();\r\n      const { w, h } = el;\r\n      const cx = el.x + w / 2;\r\n      const cy = el.y + h / 2;\r\n      ctx.translate(cx, cy);\r\n      const rotationRad = ((el.rotation || 0) * Math.PI) / 180;\r\n      ctx.rotate(rotationRad);\r\n      ctx.translate(-cx, -cy);\r\n\r\n      if (el.type === \"image\") {\r\n        const img = imageCache[el.id];\r\n        if (img) {\r\n          ctx.drawImage(img, el.x, el.y, w, h);\r\n          if (idx === selectedIdx) {\r\n            ctx.strokeStyle = \"#f59e42\";\r\n            ctx.lineWidth = 2;\r\n            ctx.strokeRect(el.x - 2, el.y - 2, w + 4, h + 4);\r\n            drawHandles(ctx, el.x, el.y, w, h);\r\n          }\r\n        }\r\n      } else if (el.type === \"text\") {\r\n        ctx.font = `${el.fontSize || 24}px Arial`;\r\n        ctx.fillStyle = el.color;\r\n        ctx.fillText(el.text, el.x, el.y + (el.fontSize || 24));\r\n        const boxW = el.w;\r\n        const boxH = el.h || (el.fontSize || 24) + 8;\r\n        if (idx === selectedIdx) {\r\n          ctx.strokeStyle = \"#f59e42\";\r\n          ctx.strokeRect(el.x - 2, el.y - 2, boxW + 4, boxH + 4);\r\n          drawHandles(ctx, el.x, el.y, boxW, boxH);\r\n        }\r\n      } else {\r\n        ctx.fillStyle = el.color;\r\n        ctx.strokeStyle = el.color;\r\n        switch (el.type) {\r\n          case \"rectangle\": case \"square\": ctx.fillRect(el.x, el.y, w, h); break;\r\n          case \"circle\": ctx.beginPath(); ctx.arc(el.x + w / 2, el.y + h / 2, w / 2, 0, 2 * Math.PI); ctx.fill(); break;\r\n          default: break;\r\n        }\r\n        if (idx === selectedIdx) {\r\n          ctx.strokeStyle = \"#f59e42\";\r\n          ctx.lineWidth = 2;\r\n          ctx.strokeRect(el.x - 2, el.y - 2, w + 4, h + 4);\r\n          drawHandles(ctx, el.x, el.y, w, h);\r\n        }\r\n      }\r\n      ctx.restore();\r\n    });\r\n    lines.forEach((line) => {\r\n      ctx.beginPath();\r\n      ctx.strokeStyle = line.mode === \"eraser\" ? \"rgba(0,0,0,1)\" : line.color || \"#333\";\r\n      ctx.lineWidth = line.size || 2;\r\n      ctx.globalCompositeOperation = line.mode === \"eraser\" ? \"destination-out\" : \"source-over\";\r\n      line.points.forEach(([x, y], i) => {\r\n        if (i === 0) ctx.moveTo(x, y);\r\n        else ctx.lineTo(x, y);\r\n      });\r\n      ctx.stroke();\r\n      ctx.globalCompositeOperation = \"source-over\";\r\n    });\r\n  }, [elements, lines, imageCache, selectedIdx]);\r\n\r\n  function drawHandles(ctx, x, y, w, h) {\r\n    const handles = [\r\n      [x - HANDLE_SIZE / 2, y - HANDLE_SIZE / 2],\r\n      [x + w - HANDLE_SIZE / 2, y - HANDLE_SIZE / 2],\r\n      [x - HANDLE_SIZE / 2, y + h - HANDLE_SIZE / 2],\r\n      [x + w - HANDLE_SIZE / 2, y + h - HANDLE_SIZE / 2],\r\n    ];\r\n    handles.forEach(([hx, hy]) => {\r\n      ctx.fillStyle = \"#fff\";\r\n      ctx.strokeStyle = \"#333\";\r\n      ctx.lineWidth = 1;\r\n      ctx.fillRect(hx, hy, HANDLE_SIZE, HANDLE_SIZE);\r\n      ctx.strokeRect(hx, hy, HANDLE_SIZE, HANDLE_SIZE);\r\n    });\r\n  }\r\n\r\n  const getHandleAt = (el, mouseX, mouseY) => {\r\n    const { w, h } = el;\r\n    const handles = [\r\n      [el.x - HANDLE_SIZE / 2, el.y - HANDLE_SIZE / 2],\r\n      [el.x + w - HANDLE_SIZE / 2, el.y - HANDLE_SIZE / 2],\r\n      [el.x - HANDLE_SIZE / 2, el.y + h - HANDLE_SIZE / 2],\r\n      [el.x + w - HANDLE_SIZE / 2, el.y + h - HANDLE_SIZE / 2],\r\n    ];\r\n    for (let i = 0; i < handles.length; i++) {\r\n      const [hx, hy] = handles[i];\r\n      if (mouseX >= hx && mouseX <= hx + HANDLE_SIZE && mouseY >= hy && mouseY <= hy + HANDLE_SIZE) {\r\n        return i;\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const handleCanvasMouseDown = (e) => {\r\n    const mouseX = e.nativeEvent.offsetX;\r\n    const mouseY = e.nativeEvent.offsetY;\r\n    let clicked = false;\r\n    for (let i = elements.length - 1; i >= 0; i--) {\r\n      const el = elements[i];\r\n      const handleIdx = getHandleAt(el, mouseX, mouseY);\r\n      if (i === selectedIdx && handleIdx !== null) {\r\n        setResizingHandle(handleIdx);\r\n        clicked = true;\r\n        break;\r\n      }\r\n      if (mouseX >= el.x && mouseX <= el.x + el.w && mouseY >= el.y && mouseY <= el.y + el.h) {\r\n        setSelectedIdx(i);\r\n        setDragOffset({ x: mouseX - el.x, y: mouseY - el.y });\r\n        setIsDragging(true);\r\n        clicked = true;\r\n        break;\r\n      }\r\n    }\r\n    if (!clicked) setSelectedIdx(null);\r\n\r\n    if (drawMode || eraserMode) {\r\n      setIsDrawing(true);\r\n      drawingPointsRef.current = [[mouseX, mouseY]];\r\n    }\r\n  };\r\n\r\n  const handleCanvasMouseMove = (e) => {\r\n    const mouseX = e.nativeEvent.offsetX;\r\n    const mouseY = e.nativeEvent.offsetY;\r\n    if (resizingHandle !== null && selectedIdx !== null) {\r\n      const el = elements[selectedIdx];\r\n      const newEl = { ...el };\r\n      if (resizingHandle === 0) {\r\n        newEl.x = mouseX;\r\n        newEl.y = mouseY;\r\n        newEl.w = el.w + (el.x - mouseX);\r\n        newEl.h = el.h + (el.y - mouseY);\r\n      } else if (resizingHandle === 1) {\r\n        newEl.y = mouseY;\r\n        newEl.w = mouseX - el.x;\r\n        newEl.h = el.h + (el.y - mouseY);\r\n      } else if (resizingHandle === 2) {\r\n        newEl.x = mouseX;\r\n        newEl.w = el.w + (el.x - mouseX);\r\n        newEl.h = mouseY - el.y;\r\n      } else if (resizingHandle === 3) {\r\n        newEl.w = mouseX - el.x;\r\n        newEl.h = mouseY - el.y;\r\n      }\r\n      newEl.w = Math.max(20, newEl.w);\r\n      newEl.h = Math.max(20, newEl.h);\r\n      if (el.type === \"text\") newEl.fontSize = Math.max(12, newEl.h - 8);\r\n      const newElements = elements.map((s, idx) => (idx === selectedIdx ? newEl : s));\r\n      setHistory((h) => {\r\n        const newHistory = h.slice(0, historyIndex + 1);\r\n        newHistory[historyIndex] = { elements: newElements, lines };\r\n        return newHistory;\r\n      });\r\n      return;\r\n    }\r\n    if (isDragging && selectedIdx !== null) {\r\n      const newElements = elements.map((s, idx) =>\r\n        idx === selectedIdx ? { ...s, x: mouseX - dragOffset.x, y: mouseY - dragOffset.y } : s\r\n      );\r\n      setHistory((h) => {\r\n        const newHistory = h.slice(0, historyIndex + 1);\r\n        newHistory[historyIndex] = { elements: newElements, lines };\r\n        return newHistory;\r\n      });\r\n    }\r\n    if (isDrawing && (drawMode || eraserMode)) {\r\n      const canvas = canvasRef.current;\r\n      const ctx = canvas.getContext(\"2d\");\r\n      const points = drawingPointsRef.current;\r\n      points.push([mouseX, mouseY]);\r\n      ctx.beginPath();\r\n      ctx.moveTo(points[points.length - 2][0], points[points.length - 2][1]);\r\n      ctx.lineTo(mouseX, mouseY);\r\n      ctx.lineWidth = eraserMode ? eraserSize : brushSize;\r\n      ctx.strokeStyle = eraserMode ? \"rgba(0,0,0,1)\" : pencilColor;\r\n      ctx.globalCompositeOperation = eraserMode ? \"destination-out\" : \"source-over\";\r\n      ctx.stroke();\r\n      ctx.globalCompositeOperation = \"source-over\";\r\n    }\r\n  };\r\n\r\n  const handleCanvasMouseUp = () => {\r\n    if (resizingHandle !== null) {\r\n      setResizingHandle(null);\r\n      saveState(elements, lines, designName);\r\n      return;\r\n    }\r\n    if (isDragging && selectedIdx !== null) {\r\n      saveState(elements, lines, designName);\r\n      setIsDragging(false);\r\n    }\r\n    if (isDrawing) {\r\n      setIsDrawing(false);\r\n      saveState(elements, lines, designName);\r\n    }\r\n  };\r\n\r\n  // ... (rest is as in previous full version, including shape/text/image/button handlers, toolbar, sidebar, and canvas UI)\r\n\r\n  // Insert all previous \"handleAddShape\", \"handleAddText\", \"handleUploadImage\", \"handleFileChange\", \"handleDownload\", \"handleSaveToCloud\", \r\n  // moveElement, clearCanvas, and handleDeleteSelected functions as shown in the detailed version above.\r\n\r\n  // ...the return JSX (the full UI including buttons and all handlers wired up) also remains the same as in my previous message.\r\n\r\n  // Return the same final UI as described earlier (toolbars, sidebar, canvas, and all handlers as above)\r\n};\r\n\r\nexport default CanvasEditor;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}